<div class="p-4 max-w-5xl mx-auto">
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-2xl font-semibold tracking-tight">Users</h2>
    <button
      type="button"
      class="inline-flex items-center gap-2 rounded-xl px-3 py-2 border border-slate-200 shadow-sm hover:shadow transition text-sm"
      (click)="ngOnInit()"
      aria-label="Reload users">
      <svg class="w-4 h-4 animate-spin" *ngIf="loading" viewBox="0 0 24 24" fill="none">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
      </svg>
      <span *ngIf="!loading">Refresh</span>
      <span *ngIf="loading">Loading…</span>
    </button>
  </div>

  <div *ngIf="!loading && error" class="mb-4 rounded-xl border border-rose-200 bg-rose-50 text-rose-800 p-3">
    {{ error }}
  </div>

  <div *ngIf="loading" class="space-y-2">
    <div class="h-10 rounded-xl bg-slate-100 animate-pulse"></div>
    <div class="h-10 rounded-xl bg-slate-100 animate-pulse"></div>
    <div class="h-10 rounded-xl bg-slate-100 animate-pulse"></div>
  </div>

  <ng-container *ngIf="!loading && !error">
    <!-- Desktop table -->
    <div class="hidden md:block overflow-x-auto rounded-2xl border border-slate-200 shadow-sm">
      <table class="min-w-full text-sm">
        <thead class="bg-slate-50 text-left text-slate-600">
        <tr>
          <th class="px-4 py-3 font-medium">ID</th>
          <th class="px-4 py-3 font-medium">Name</th>
          <th class="px-4 py-3 font-medium">Email</th>
          <th class="px-4 py-3 font-medium">Role</th>
          <th class="px-4 py-3 font-medium">Headline</th>
          <th class="px-4 py-3 font-medium">Location</th>
        </tr>
        </thead>
        <tbody class="divide-y divide-slate-200 text-slate-800">
        <tr *ngFor="let u of users$ | async; trackBy: trackById" class="hover:bg-slate-50">
          <td class="px-4 py-3 font-mono text-[11px]">{{ u.id }}</td>
          <td class="px-4 py-3 font-medium">{{ displayName(u) }}</td>
          <td class="px-4 py-3">{{ u.email }}</td>
          <td class="px-4 py-3">
              <span class="inline-flex items-center rounded-lg border border-slate-200 px-2 py-1 text-xs">
                {{ u.role }}
              </span>
          </td>
          <td class="px-4 py-3">{{ u.profile?.headline || '—' }}</td>
          <td class="px-4 py-3">{{ u.profile?.location || '—' }}</td>
        </tr>
        </tbody>
      </table>
    </div>

    <!-- Mobile cards -->
    <div class="md:hidden space-y-3">
      <div *ngFor="let u of users$ | async; trackBy: trackById" class="rounded-2xl border border-slate-200 p-4 shadow-sm">
        <div class="flex items-center justify-between">
          <div class="text-base font-semibold">{{ displayName(u) }}</div>
          <div class="text-xs text-slate-500">#{{ u.id.slice(0, 8) }}</div>
        </div>
        <div class="mt-1 text-sm text-slate-700">{{ u.email }}</div>
        <div class="mt-1 text-xs text-slate-500" *ngIf="u.profile?.headline">{{ u.profile?.headline }}</div>
        <div class="mt-2 flex flex-wrap gap-2">
          <span class="inline-flex rounded-lg border border-slate-200 px-2 py-1 text-xs">{{ u.role }}</span>
          <span *ngIf="u.profile?.location" class="inline-flex rounded-lg border border-slate-200 px-2 py-1 text-xs">
            {{ u.profile?.location }}
          </span>
        </div>
      </div>
    </div>

    <div *ngIf="(users$ | async)?.length === 0"
         class="mt-6 rounded-2xl border-2 border-dashed border-slate-200 p-8 text-center text-slate-500">
      No users found.
    </div>
  </ng-container>
</div>
